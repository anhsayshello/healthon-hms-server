generator client {
  provider = "prisma-client-js"
   previewFeatures = ["fullTextSearchPostgres"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  NURSE
  DOCTOR
  LAB_TECHNICIAN
  PATIENT
  CASHIER
}

enum Status {
  ACTIVE 
  INACTIVE
  DORMANT
}

enum JobType {
  FULL 
  PART
}

enum Gender {
  MALE
  FEMALE
}

enum AppointmentStatus  {
  PENDING 
  SCHEDULED
  CANCELLED
  COMPLETED
}

enum Weekday {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum PaymentMethod {
  CASH
  CARD
}

enum PaymentStatus {
  PAID
  UNPAID
  PART  
}

model Patient {
  uid                      String            @id
  first_name               String
  last_name                String
  date_of_birth            DateTime
  gender                   Gender            @default(MALE)
  email                    String            @unique
  phone                    String
  marital_status           String
  address                  String
  emergency_contact_name   String
  emergency_contact_number String
  relation                 String
  blood_group              String?
  allergies                String?
  medical_conditions       String?
  medical_history          String?
  insurance_provider       String?
  insurance_number         String?
  privacy_consent          Boolean
  service_consent          Boolean
  medical_consent          Boolean
  photo_url                String?

  appointments             Appointment[]
  medical                  MedicalRecord[]
  payments                 Payment[]
  ratings                  Rating[]

  created_at                DateTime          @default(now())
  updated_at                DateTime          @updatedAt
}

model Doctor {
  uid                      String            @id
  email                    String            @unique
  first_name               String
  last_name                String
  specialization           String
  license_number           String
  phone                    String
  address                  String
  department               String?
  photo_url                String?
  availability_status       String?

  type                     JobType @default(FULL)
  working_days             WorkingDays[]
  appointments             Appointment[]
  ratings                  Rating[]
  diagnosis                Diagnosis[]

  created_at                DateTime          @default(now())
  updated_at                DateTime          @updatedAt
}

model WorkingDays {
  id                       Int @id @default(autoincrement())
  doctor_id                String
  day                      Weekday
  start_time               String
  close_time               String

  doctor    Doctor  @relation(fields: [doctor_id], references: [uid], onDelete: Cascade)
  
  created_at                DateTime          @default(now())
  updated_at                DateTime          @updatedAt
}

model Staff {
  uid                      String            @id
  email                    String            @unique
  first_name               String
  last_name                String
  phone                    String
  address                  String
  department               String?
  license_number           String?
  photo_url                String?

  role                     Role
  status                   Status @default(ACTIVE)

  created_at                DateTime          @default(now())
  updated_at                DateTime          @updatedAt
}

model Appointment {
  id               Int              @id @default(autoincrement())
  patient_id       String
  doctor_id        String
  appointment_date DateTime
  time             String
  status           AppointmentStatus    @default(PENDING)
  type             String
  note             String?

  patient          Patient          @relation(fields: [patient_id], references: [uid], onDelete: Cascade)
  doctor           Doctor           @relation(fields: [doctor_id], references: [uid], onDelete: Cascade)

  bills            Payment[]
  medical          MedicalRecord[]

  reason           String?
  created_at       DateTime         @default(now())
  updated_at       DateTime         @updatedAt
}

model Payment {
  id              Int               @id   @default(autoincrement())
  bill_id         Int?
  patient_id      String
  appointment_id  Int               @unique
  bill_date       DateTime
  payment_date    DateTime
  discount        Float
  total_amount    Float
  amount_paid     Float

  payment_method  PaymentMethod     @default(CASH)
  status          PaymentStatus     @default(UNPAID)
  receipt_number  Int               @default(autoincrement())

  appointment     Appointment           @relation(fields: [appointment_id], references: [id], onDelete: Cascade)
  patient         Patient               @relation(fields: [patient_id], references: [uid], onDelete: Cascade)
  bills           PatientBills[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

model PatientBills {
  id            Int       @id @default(autoincrement())
  bill_id       Int
  service_id    Int
  service_date  DateTime
  quantity      Int 
  unit_cost     Float
  total_cost    Float

  service Services        @relation(fields: [service_id], references: [id])
  payment Payment         @relation(fields: [bill_id], references: [id], onDelete: Cascade)

  created_at    DateTime  @default(now())
  updated_at    DateTime  @updatedAt
}

model LabTest {
  id             Int       @id @default(autoincrement())
  record_id      Int
  test_date      DateTime
  result         String
  status         String
  notes          String
  service_id     Int       @unique

  services       Services  @relation(fields: [service_id], references: [id])
  medical_record MedicalRecord @relation(fields: [record_id], references: [id], onDelete: Cascade)

  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt
}

model MedicalRecord {
  id             Int          @id @default(autoincrement())
  patient_id     String
  appointment_id Int
  doctor_id      String
  treatment_plan String?
  lab_request    String?

  appointment    Appointment  @relation(fields: [appointment_id], references: [id], onDelete: Cascade)
  patient        Patient      @relation(fields: [patient_id], references: [uid], onDelete: Cascade)
  lab_test       LabTest[]
  notes          String?

  vital_signs    VitalSigns[]
  diagnosis      Diagnosis[]
  prescriptions  Prescription[]

  created_at     DateTime     @default(now())
  updated_at     DateTime     @updatedAt
}

model VitalSigns {
  id                Int             @id @default(autoincrement())
  patient_id        String
  medical_id        Int
  medical_record    MedicalRecord  @relation(fields: [medical_id], references: [id], onDelete: Cascade)
  body_temperature  Float
  systolic          Int
  diastolic         Int
  heart_rate         String
  respiratory_rate  Int?
  oxygen_saturation  Int?
  weight            Float
  height            Float

  created_at        DateTime        @default(now())
  updated_at        DateTime        @updatedAt
}

model Diagnosis {
  id                       Int             @id @default(autoincrement())
  patient_id               String
  medical_id               Int
  doctor_id                String
  doctor                   Doctor          @relation(fields: [doctor_id], references: [uid])
  symptoms                 String
  diagnosis                String
  notes                    String?
  prescribed_medications   String?
  follow_up_plan           String?

  medical                  MedicalRecord  @relation(fields: [medical_id], references: [id], onDelete: Cascade)

  created_at               DateTime        @default(now())
  updated_at               DateTime        @updatedAt
}

model Prescription {
  id             Int             @id @default(autoincrement())
  medical_id     Int
  medication     String
  dosage         String
  frequency      String
  duration       String
  instructions   String?

  medical_record MedicalRecord   @relation(fields: [medical_id], references: [id], onDelete: Cascade)

  created_at     DateTime        @default(now())
  updated_at     DateTime        @updatedAt
}


model AuditLog {
  id      Int   @id @default(autoincrement())
  user_id        String
  record_id      String
  action         String
  details         String?
  model          String

  created_at     DateTime      @default(now())
  updated_at     DateTime      @updatedAt
}

model Rating {
  id           Int        @id   @default(autoincrement())
  staff_id     String
  patient_id   String
  rating       Int
  comment      String?

  doctor       Doctor     @relation(fields: [staff_id], references: [uid], onDelete: Cascade)
  patient      Patient    @relation(fields: [patient_id], references: [uid], onDelete: Cascade)

  created_at   DateTime   @default(now())
  updated_at   DateTime   @updatedAt
}

model Services {
  id           Int           @id @default(autoincrement())
  service_name String
  description  String
  price        Float
  labtest      LabTest?
  bills        PatientBills[]

  created_at   DateTime      @default(now())
  updated_at   DateTime      @updatedAt
}